# Define variables
$taskName = "StartSProgram"
$actionPath = "C:\Users\User\Desktop\s.exe"
$actionArguments = ""
$triggerId = "LogonTrigger"
$triggerEnabled = $true
$triggerAtStartup = $true

# Check if the task exists
$existingTask = Get-ScheduledTask -TaskName $taskName -ErrorAction SilentlyContinue

if ($existingTask -eq $null) {
    # Task does not exist, create new task
    $trigger = New-ScheduledTaskTrigger -AtLogon -User "AnyUser" -ExecutionTimeLimit (New-TimeSpan -Minutes 30)
    $action = New-ScheduledTaskAction -Execute $actionPath -Argument $actionArguments
    Register-ScheduledTask -TaskName $taskName -Trigger $trigger -Action $action -User "NT AUTHORITY\SYSTEM" -RunLevel Highest -Force
    Write-Host "Task '$taskName' created successfully."
} else {
    Write-Host "Task '$taskName' already exists."
}

# Enable trigger at system startup
$task = Get-ScheduledTask -TaskName $taskName
$trigger = $task.Triggers | Where-Object { $_.Id -eq $triggerId }

if ($trigger -ne $null) {
    $trigger.Enabled = $triggerEnabled
    $trigger.AtStartup = $triggerAtStartup
    Set-ScheduledTask -TaskName $taskName -Trigger $trigger -User "NT AUTHORITY\SYSTEM"
    Write-Host "Trigger '$triggerId' enabled for task '$taskName'."
} else {
    Write-Host "Trigger '$triggerId' not found for task '$taskName'."
}
